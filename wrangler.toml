name = "gb-heat-pump-app-v1"
main = "src/app.ts"
# Must NOT be in the future. Use a recent date.
compatibility_date = "2024-12-20"

workers_dev = true

# D1
[[d1_databases]]
binding = "DB"
database_name = "GREENBRO_DB"
database_id = "ee7ad98b-3629-4985-bd7d-a60c401953a7"

[vars]
APP_BASE_URL = "https://gb-heat-pump-app-v1.bradleyayliffl.workers.dev"
RETURN_DEFAULT = "https://www.greenbro.co.za/"
TIMEZONE = "Africa/Johannesburg"
CURSOR_SECRET = "change-me-with-a-strong-secret"

# Ops thresholds (override per-env if needed)
HEARTBEAT_INTERVAL_SECS = "30"        # expected device heartbeat period
OFFLINE_MULTIPLIER = "6"              # mark offline if > 6Ã— heartbeat interval (=> 3 min w/ 30s hb)

# --- Observability / Logs ---
[observability]
  [observability.logs]
  enabled = true
  head_sampling_rate = 1
  invocation_logs = true
  persist = true

# --- Cron schedules ---
# Every 5 minutes: set devices offline if stale
[triggers]
crons = ["*/5 * * * *"]

[[r2_buckets]]
binding = "GB_BUCKET"
bucket_name = "greenbro-brand"
# optional for local dev:
# preview_bucket_name = "greenbro-brand-dev"
