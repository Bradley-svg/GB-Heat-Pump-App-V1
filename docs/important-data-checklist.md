# Important-Data Handling Checklist - Mode A (v2025-11-11)

| Asset / Dataset | Residency | Owners (Dual-Control) | Storage & Access Controls | Rotation / Review Cadence | Verification Steps |
| --- | --- | --- | --- | --- | --- |
| Device ? DID mapping table (`services/cn-gateway` Postgres `mapping`) | Mainland China DC (VPC subnet `cn-gateway`) | Ops Engineering Lead + Compliance Lead | Postgres behind mTLS; access via bastion + short-lived IAM tokens; read-only replicas blocked | Quarterly review of access lists; purge inactive mappings > 18 months | Run `SELECT COUNT(*) ...` diff + audit logs; confirm dual approvals logged in `audit_log`. |
| Pseudonymization KMS keys (Alibaba/Tencent/Huawei HMAC keys) | Mainland China KMS | Ops Engineering Lead + Security Lead | Cloud KMS policies require two approvers; keys non-exportable | Rotate every 12 months or incident; document new `KMS_KEY_VERSION` | Record rotation via `/admin/rotate-key`; attach ticket + HSM receipts. |
| Device shared-secret hashes (`devices.device_key_hash`) | Mainland China D1/Postgres | Device Platform PM + Security Lead | Hash-only storage; updates via controlled `wrangler d1 execute` workflows | Rotate per firmware release or compromise; monthly NULL scan | Run `tests/security/worker.security.test.ts` + SQL spot checks. |
| Batch export Ed25519 private key (CN gateway) | CN secure HSM | Ops Engineering Lead + Legal Rep | Stored in encrypted filesystem with hardware-backed key; referenced by path only | Rotate annually; destroy old key once overseas pubkey deployed | Upload new pubkey via `wrangler secret put EXPORT_VERIFY_PUBKEY` for overseas worker; attach approval ticket. |
| Cloudflare Access config (`ACCESS_JWKS_URL`, `ACCESS_AUD`) | Cloudflare Access (global) | Platform Engineering Lead + Security Lead | Managed via Access admin + `wrangler secret`; protected by Okta SSO | Quarterly review of Access policies/scopes | Run `node scripts/ensure-prod-shim-disabled.mjs --env production`; export Access audit logs. |
| Cursor sealing secret (`CURSOR_SECRET`) | Workers secret store | Platform Engineering Lead + Compliance Lead | Injected with `wrangler secret`; never logged | Rotate every 12 months; update `.dev.vars` sample | Run cursor unit tests + verify `cursor.rotate` log entry. |
| Client Event token secret (`CLIENT_EVENT_TOKEN_SECRET`) | Workers secret store | Platform Engineering + App PM | Production-only secret; staging uses separate value | Rotate every 6 months; purge cached grants in `client_events` | Run `src/lib/auth/__tests__/telemetry-token.test.ts`; confirm Access logs. |
| Hashed client event emails (`client_events.user_email`) | Workers D1 (hashed values only) | Platform Engineering Lead + Compliance Lead | Stored as `sha256:<digest>` derived from secret; admin backfill endpoint cleans legacy rows | Backfill immediately after each secret rotation; weekly plaintext scan | Call `POST /api/admin/client-events/backfill` (Access + admin role) until response `{ "status": "complete" }`; capture log. |
| Mode A batch export artifacts (`services/cn-gateway` queue + `services/overseas-api`) | CN gateway + Cloudflare Workers (global) | Platform API Lead + Compliance Lead | Raw exports signed with Ed25519, transmitted over TLS only; overseas Worker requires Access JWT + signature | Review exporter + worker configs before each deploy | Health-check `/health` on overseas Worker; expect `signatureConfigured: true`; monitor `exporterBatches` metrics. |

## Operational Checklist
1. **Change Tickets** - Every access or rotation must reference a Jira ticket with both approving owners.
2. **Audit Logs** - Verify `services/cn-gateway.audit_log` has entries for each mapping export, key rotation, or admin action within 24h.
3. **Incident Response** - On suspected leakage, set `EXPORT_ENABLED=false`, keep `ALLOW_RAW_INGEST` unset (default), rotate pseudonymization keys, and reissue Access secrets within 48h.
4. **Documentation Hooks** - Link this file from `docs/deployment-runbook.md` and the compliance Confluence space; update whenever ownership or cadence changes.
5. **Quarterly Review** - Compliance Lead schedules review, signs off via PR summarizing ownership/cadence changes, and confirms `EXPORT_VERIFY_PUBKEY` + Access configs remain valid.
